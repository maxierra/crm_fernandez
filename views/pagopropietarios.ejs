<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago a Propietarios - Elegante</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/pagoalquiler.css" />
</head>

<body>
    <%- include('navbar') %>
    <div class="container">
        <div class="header">
            <h1>Pago a Propietarios</h1>
        </div>
        <div class="content">
            <!-- Formulario de Búsqueda por Propietario -->
            <form id="searchForm" class="form-inline mb-4 animate">
                <div class="input-group w-100">
                    <input type="text" id="propietario" name="propietario" class="form-control" placeholder="Buscar propietario" required>
                    <div class="input-group-append">
                        <button type="submit" class="btn btn-primary">Buscar</button>
                    </div>
                </div>
            </form>

            <!-- Resultado de la búsqueda -->
            <div id="resultado" class="animate" style="animation-delay: 0.2s;">
                <!-- Aquí se mostrará el resultado de la búsqueda -->
            </div>

            <div class="section payment-method animate" style="animation-delay: 0.4s;">
                <h2>Método de Pago</h2>
                <div class="payment-options">
                    <div class="payment-option active" data-method="efectivo">Efectivo</div>
                    <div class="payment-option" data-method="transferencia">Transferencia</div>
                </div>
            </div>

            <div id="cbu" class="cbu animate" style="animation-delay: 0.6s;">
                <p>CBU para transferencia: <span id="cbuNumber">No disponible</span></p>
                <p id="observaciones"></p> <!-- Nuevo párrafo para observaciones -->
            </div>
            
            <button id="processPayment" class="animate" style="animation-delay: 1s;">Procesar Pago</button>
        </div>
    </div>

    <script>
       // Código de búsqueda del propietario
    document.getElementById('searchForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const propietario = document.getElementById('propietario').value;

        fetch('/buscar-propietario', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ propietario: propietario })
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(error => {
                        throw new Error(error.message || 'Error desconocido');
                    });
                }
                return response.json();
            })
            .then(data => {
                const resultadoDiv = document.getElementById('resultado');
                let resultHtml = '';

                if (data.error) {
                    resultHtml += `<p class="text-danger">Error: ${data.error}</p>`;
                } else {
                    resultHtml += `<div class="section payment-details animate" style="animation-delay: 0.2s;">`;
                    resultHtml += `<h2>Detalle de Pagos</h2>`;
                    resultHtml += `<div class="detail-row">`;
                    resultHtml += `<span>Importe del periodo:</span><span>$${data.importePeriodo.toFixed(2)}</span>`;
                    resultHtml += `</div>`;
                    resultHtml += `<div class="detail-row deduction">`;
                    resultHtml += `<span>Monto ABL:</span><span>-$${data.montoABL.toFixed(2)}</span>`;
                    resultHtml += `</div>`;
                    resultHtml += `<div class="detail-row deduction">`;
                    resultHtml += `<span>Administración :</span><span>-$${data.administracion.toFixed(2)}</span>`;
                    resultHtml += `</div>`;
                    resultHtml += `<div class="detail-row total">`;
                    resultHtml += `<span>Total:</span><span>$${data.total.toFixed(2)}</span>`;
                    resultHtml += `</div>`;
                    resultHtml += `</div>`;

                    document.getElementById('cbuNumber').textContent = data.cbu;
                    document.getElementById('observaciones').textContent = data.observaciones || ''; // Mostrar observaciones
                }

                resultadoDiv.innerHTML = resultHtml;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('resultado').innerHTML = `<p class="text-danger">Error en la respuesta del servidor: ${error.message}</p>`;
            });
    });
        document.addEventListener('DOMContentLoaded', function () {
            const paymentOptions = document.querySelectorAll('.payment-option');
            const cbuDiv = document.getElementById('cbu');
            const processButton = document.getElementById('processPayment');

            paymentOptions.forEach(option => {
                option.addEventListener('click', function () {
                    paymentOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');

                    if (this.dataset.method === 'transferencia') {
                        cbuDiv.style.display = 'block';
                    } else {
                        cbuDiv.style.display = 'none';
                    }
                });
            });

            processButton.addEventListener('click', function () {
                const selectedMethod = document.querySelector('.payment-option.active').dataset.method;
                alert(`Pago procesado con método: ${selectedMethod}`);
                // Aquí podrías agregar el código para procesar el pago en el backend
            });
        });
    </script>
</body>

</html>
